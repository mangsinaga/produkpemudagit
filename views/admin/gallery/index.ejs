<% locals.page = 'gallery' %>

<div class="top-bar">
    <h1 class="page-title">Galeri Produk</h1>
    <a href="/admin/gallery/upload" class="btn btn-primary">
        <i class="bi bi-cloud-upload"></i> Upload Foto
    </a>
</div>

<div class="card">
    <div class="card-header">
        <h5 class="mb-0">Daftar Foto Galeri</h5>
    </div>
    <div class="card-body">
        <% if (gallery && gallery.length > 0) { %>
            <div class="row g-3">
                <% gallery.forEach(image => { %>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="card gallery-card">
                            <img src="<%= image.filename %>" class="card-img-top" alt="Gallery Image">
                            <div class="card-body p-2">
                                <small class="text-muted d-block mb-2">
                                    <%= new Date(image.uploaded_at).toLocaleDateString('id-ID', { 
                                        day: 'numeric', 
                                        month: 'long', 
                                        year: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    }) %>
                                </small>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-primary" onclick="copyImageLink('<%= image.filename %>')">
                                        <i class="bi bi-link-45deg"></i> Copy Link
                                    </button>
                                    <a href="/admin/gallery/delete/<%= image.id %>" 
                                       class="btn btn-sm btn-outline-danger" 
                                       onclick="return confirm('Apakah Anda yakin ingin menghapus foto ini?')">
                                        <i class="bi bi-trash"></i> Hapus
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <div class="text-center py-5">
                <i class="bi bi-images display-1 text-muted"></i>
                <h5 class="mt-3 text-muted">Belum ada foto galeri</h5>
                <p class="text-muted">Mulai dengan mengupload foto produk pertama Anda</p>
                <a href="/admin/gallery/upload" class="btn btn-primary">
                    <i class="bi bi-cloud-upload"></i> Upload Foto Sekarang
                </a>
            </div>
        <% } %>
    </div>
</div>

<style>
.gallery-card {
    transition: transform 0.2s;
}
.gallery-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
.gallery-card .card-img-top {
    height: 200px;
    object-fit: cover;
}
</style>

<script>
function copyImageLink(imagePath) {
    const fullUrl = window.location.origin + imagePath;
    navigator.clipboard.writeText(fullUrl).then(() => {
        alert('Link gambar berhasil disalin!');
    }).catch(err => {
        console.error('Gagal menyalin link:', err);
        alert('Gagal menyalin link. Silakan coba lagi.');
    });
}
</script>
